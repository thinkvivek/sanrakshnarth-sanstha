<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Control-M Job Dependency Graph</title>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    #network {
      width: 100%;
      height: 600px;
      border: 1px solid lightgray;
    }
    #details {
      width: 100%;
      height: 200px;
      overflow-y: auto;
      border: 1px solid lightgray;
      padding: 10px;
      font-family: Arial, sans-serif;
    }
    body {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div id="network"></div>
  <div id="details">Click a job to see details here...</div>

  <script>
    fetch('job_dependencies.json')
      .then(response => response.json())
      .then(data => {
        const nodes = new vis.DataSet(data.nodes.map(node => ({
          id: node.id,
          label: node.JOBNAME,
          title: `Job: ${node.JOBNAME}\nDesc: ${node.DESCRIPTION || 'N/A'}\nNode: ${node.NODEID || 'N/A'}`,
          fullDetails: node
        })));
        const edges = new vis.DataSet(data.edges);

        const container = document.getElementById('network');
        const graphData = { nodes: nodes, edges: edges };
        const options = {
          nodes: {
            shape: 'dot',
            size: 15,
            font: { size: 12 },
            borderWidth: 2
          },
          edges: {
            arrows: 'to',
            smooth: { type: 'curvedCW' }
          },
          layout: {
            hierarchical: {
              direction: 'UD',
              sortMethod: 'directed'
            }
          },
          physics: false,
          interaction: { hover: true, tooltipDelay: 200 }
        };

        const network = new vis.Network(container, graphData, options);

        network.on('click', function(params) {
          const detailsDiv = document.getElementById('details');
          if (params.nodes.length > 0) {
            const nodeId = params.nodes[0];
            const node = nodes.get(nodeId);
            const details = node.fullDetails;
            detailsDiv.innerHTML = `
              <h3>${details.JOBNAME}</h3>
              <p><strong>Description:</strong> ${details.DESCRIPTION || 'N/A'}</p>
              <p><strong>Node ID:</strong> ${details.NODEID || 'N/A'}</p>
              <p><strong>Command Line:</strong> ${details.CMDLINE || 'N/A'}</p>
              <p><strong>Weeks Calendar:</strong> ${details.WEEKSCAL || 'N/A'}</p>
              <p><strong>In Conditions:</strong> ${details.INCOND ? JSON.stringify(details.INCOND, null, 2) : 'None'}</p>
              <p><strong>Out Conditions:</strong> ${details.OUTCOND ? JSON.stringify(details.OUTCOND, null, 2) : 'None'}</p>
            `;
          } else {
            detailsDiv.innerHTML = 'Click a job to see details here...';
          }
        });
      })
      .catch(error => console.error('Error loading JSON:', error));
  </script>
</body>
</html>
